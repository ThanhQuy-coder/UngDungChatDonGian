<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.effect.DropShadow?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>

<AnchorPane xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.simplechat.controllers.ChatController">

    <Pane prefHeight="600" prefWidth="900" style="-fx-background-color: #f5f5f5;">
        <!-- Header -->
        <HBox prefHeight="60" prefWidth="900" style="-fx-background-color: #3949AB;">
            <Label style="-fx-font-size: 24px;" text="Chat Application" textFill="white">
                <padding>
                    <Insets left="20" top="15" />
                </padding>
                <effect>
                    <DropShadow color="#00000080" radius="3" />
                </effect>
            </Label>

            <!-- User info and logout -->
            <HBox alignment="CENTER_RIGHT" spacing="10" HBox.hgrow="ALWAYS">
                <Label fx:id="usernameLabel" style="-fx-font-size: 16px;" textFill="white" />
                <Button onAction="#handleLogout" style="-fx-background-color: #e53935; -fx-text-fill: white;" text="Logout" />
                <padding>
                    <Insets right="20" />
                </padding>
            </HBox>
        </HBox>

        <!-- Main Content -->
        <BorderPane layoutY="60" prefHeight="540" prefWidth="900">
            <!-- Left - Contacts List -->
            <left>
                <VBox prefWidth="250" style="-fx-background-color: #e3f2fd;">
                    <!-- Tabs: Contacts | Requests -->
                    <HBox spacing="10" style="-fx-padding: 10;">
                        <Button fx:id="contactsTabBtn" onAction="#showContactsTab"
                                style="-fx-background-color: transparent; -fx-font-weight: bold; -fx-border-color: transparent transparent #1A237E transparent; -fx-border-width: 0 0 2 0;"
                                text="Contacts" />
                        <Button fx:id="requestsTabBtn" onAction="#showRequestsTab"
                                style="-fx-background-color: transparent; -fx-font-weight: normal; -fx-border-color: transparent; -fx-border-width: 0 0 2 0;"
                                text="Requests" />
                        <Button fx:id="sentTabBtn" onAction="#showSentTab"
                                style="-fx-background-color: transparent; -fx-font-weight: normal; -fx-border-color: transparent; -fx-border-width: 0 0 2 0;"
                                text="Sent" />
                    </HBox>

                    <!-- StackPane để chuyển đổi giữa 2 danh sách -->
                    <StackPane fx:id="tabContent" VBox.vgrow="ALWAYS">
                        <!-- Contacts -->
                        <VBox fx:id="contactsPane">
                            <ListView fx:id="contactsList" style="-fx-background-color: transparent; -fx-border-width: 0;" />
                        </VBox>

                        <!-- Requests -->
                        <VBox fx:id="requestsPane" visible="false" managed="false">
                            <Button text="Gửi lời mời kết bạn" onAction="#handleSendFriendRequest"
                                    style="-fx-background-color: #3949AB; -fx-text-fill: white; -fx-padding: 5 10;"/>
                            <Button text="Refresh" onAction="#handleRefreshRequests"
                                    style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-padding: 5 10;"/>
                            <ListView fx:id="requestsList" style="-fx-background-color: transparent; -fx-border-width: 0;" />
                        </VBox>

                        <!-- Sent -->
                        <VBox fx:id="sentPane" visible="false" managed="false">
                            <Label text="Lời mời đã gửi:" style="-fx-padding: 10; -fx-font-weight: bold;" />
                            <Button text="Refresh" onAction="#handleRefreshSent"
                                    style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-padding: 5 10;"/>
                            <ListView fx:id="sentRequestsList" style="-fx-background-color: transparent; -fx-border-width: 0;" />
                        </VBox>
                    </StackPane>
                </VBox>
            </left>



            <!-- Center - Chat Area -->
            <center>
                <VBox style="-fx-background-color: white; -fx-border-color: #e0e0e0; -fx-border-width: 1;">
                    <!-- Chat header -->
                    <HBox style="-fx-background-color: #bbdefb; -fx-padding: 10;">
                        <Label fx:id="currentChatLabel" style="-fx-font-size: 16px; -fx-text-fill: #1A237E;" text="Select a contact to chat" />
                    </HBox>

                    <!-- Messages area -->
                    <ListView fx:id="messagesList" style="-fx-background-color: white;" VBox.vgrow="ALWAYS">
                        <items>
                            <FXCollections fx:factory="observableArrayList">
                                <String fx:value="Welcome to the chat!" />
                            </FXCollections>
                        </items>
                    </ListView>

                    <!-- Message input -->
                    <HBox style="-fx-padding: 10; -fx-spacing: 10; -fx-background-color: #f5f5f5;">
                        <TextField fx:id="messageInput" promptText="Type your message here..." HBox.hgrow="ALWAYS" />
                        <Button onAction="#handleSendMessage" style="-fx-background-color: #3949AB; -fx-text-fill: white;" text="Send" />
                    </HBox>
                </VBox>
            </center>

            <!-- Right - User details (optional) -->
            <right>
                <VBox prefWidth="200" style="-fx-background-color: #e3f2fd; -fx-padding: 10;">
                    <Label style="-fx-font-size: 18px; -fx-text-fill: #1A237E;" text="My Profile">
                        <effect>
                            <DropShadow color="#00000040" radius="2" />
                        </effect>
                    </Label>

                    <ImageView fitHeight="100" fitWidth="100" preserveRatio="true">
                        <Image url="@/images/img_8.png" />
                    </ImageView>

                    <Label fx:id="userProfileName" style="-fx-font-size: 16px; -fx-text-fill: #1A237E;" text="Username" />
                    <Label style="-fx-font-size: 14px; -fx-text-fill: #4CAF50;" text="Status: Online" />

                    <Button onAction="#handleChangeAvatar" style="-fx-background-color: #7986CB; -fx-text-fill: white; -fx-margin-top: 20;" text="Change Avatar" />
                </VBox>
            </right>
        </BorderPane>
    </Pane>
</AnchorPane>
